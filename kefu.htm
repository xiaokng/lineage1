<html>ï»?
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache"><title>ä¼ä¸šå®¢æˆ·æœåŠ¡</title>
<style type="text/css">
.lbf-panel { min-width:400px; _width:400px; padding:0 20px;}
</style>
<script type="text/javascript" src="../combo.b.qq.com/lbf/0.7.3/LBF.js" tppabs="http://combo.b.qq.com/lbf/0.7.3/LBF.js"></script>
<script>
// LBF setting & preload
LBF.set({
  theme: 'bootstrap',
  useCombo: true,
  version: 20140303
});

LBF.use(['ui.widget.Panel.ConfirmPanel', 'ui.widget.Panel.AlertPanel'], function(){});

var domain = "qq.com";
var wpaType = 1;
var browserType = 3;
var g_kfuin = 122118253;
var g_accoutname = 122118253;
var bizParam = "000011:400598:|m:13|f:Gtt1";
var bizSize = 0;
var envID = 112;
var version = 3;
var appointed = 0;
var appointedType = 0;
var sessionVersion = 3;
var sessionParam = "000011:400598:|m:13|f:Gtt1";
var bizID = 11;
var customizeUrl = '';
var browerName = 'mozilla/5.0 (windows nt 5.1) applewebkit/537.36 (khtml, like gecko) chrome/31.0.1650.63 safari/537.36';
var bt = '';
var debug = 0;
var wpaFrom = '1';
var clickId = '32afa4e179797150719c38fe7d88f35a84';

function win_onload() {
  LBF.use(['ui.widget.Panel.ConfirmPanel', 'ui.widget.Panel.AlertPanel'], function(require, ConfirmPanel, AlertPanel){
    var alert = function(msg, ok){
          new AlertPanel({
            title: 'è¯·ç¡®è®?,
            content: msg,
            events: {
              ok: function(){
                ok && ok();
                this.remove();
              }
            }
          });
        },
        confirm = function(msg, ok, cancel){
          new ConfirmPanel({
            title: 'è¯·ç¡®è®?,
            content: msg,
            events: {
              ok: function(){
                ok && ok();
                this.remove();
              },
              cancel: function(){
                cancel && cancel();
                this.remove();
              }
            }
          });
        };

    if (19 == envID) {
        var referrer = getDomain(document.referrer);
        if (referrer != "paipai.com" && referrer != "soso.com" && referrer != 'yixun.com') {
            alert("è¥é”€QQåœ¨çº¿å’¨è¯¢æ— æƒé™åœ¨å½“å‰åœºæ™¯ä½¿ç”¨ï¼?, closeWindow);
            return;
        }
    }

    //debug info
    if(1 == debug) {
        alert("browerType=" + browserType + "; qqverison=" + v + "; browerName=" + browerName + "; bt=" + bt);
    }

    // å¹¿ç”µé€šå®¢æˆ·ç«¯é€»è¾‘
    if(wpaFrom === '5' || wpaFrom === '7'){
        getSigtSigu(g_kfuin, bizParam, bizSize);

        return;
    }

    //QQ WPA
    if (1 == wpaType && 4 != browserType) {
        if(g_accoutname == '122118253'){ // kf.qq.comçš„å·ç ï¼Œä¸åšå®¢æˆ·ç«¯ç‰ˆæœ¬çš„æ£€æŸ¥ã€?
            var v = 2384;
        }
        else{
            var v = IsInstallQQ();
        }

        if (3 > browserType) //IEã€FF Browserï¼?Chromeå¾…QQ2012beta3ç‰ˆæœ¬æ™®åŠ
        {
            if (10 == bizID || 1003 == bizID) {
                if(g_accoutname == '800010000'){
                    var msg = "ç¡®è®¤æ‰“å¼€QQä¸ä¸­å›½ç”µä¿¡QQå¯¹è¯ï¼?;
                }
                else{
                    var msg = "ç¡®è®¤æ‰“å¼€QQä¸è¥é”€QQ" + g_accoutname + "å¯¹è¯ï¼?;
                }

                confirm(msg, function(){
                  if (v >= 2383 || '4008000000' == g_accoutname) //for above hummer 1.26 version
                  {
                      getSigtSigu(g_kfuin, bizParam, bizSize);

                      return;
                  }

                  vipCase();
                }, closeWindow);                
            } else {
              if (v >= 2383 || '4008000000' == g_accoutname) //for above hummer 1.26 version
              {
                  getSigtSigu(g_kfuin, bizParam, bizSize);

                  return;
              }
              
              vipCase();
            }          
        }
        else //other Browser
        {
            if(g_accoutname == '800010000'){
                var msg = 11 == bizID ? "ç¡®è®¤æ‰“å¼€QQä¸å†°å°å¤©å ‚å®¢æœå¯¹è¯ï¼Ÿ" : "ç¡®è®¤æ‰“å¼€QQä¸ä¸­å›½ç”µä¿¡QQå¯¹è¯ï¼?;
            }
            else{
                var msg = 11 == bizID ? "ç¡®è®¤æ‰“å¼€QQä¸å†°å°å¤©å ‚å®¢æœå¯¹è¯ï¼Ÿ" : "ç¡®è®¤æ‰“å¼€QQä¸è¥é”€QQ" + g_accoutname + "å¯¹è¯ï¼?;
            }
            confirm(
              msg, 
              function(){
                getSigtSigu(g_kfuin, bizParam, bizSize);
              }, 
              vipCase
            );
        }
    } else {
      vipCase();
    }    


    function vipCase(){
      if (112 == envID) //ä¸­å›½ç”µä¿¡æ¨¡å¼ç‰¹æ®Šä¸šåŠ¡é€»è¾‘
      {
          if (10 == bizID || 1003 == bizID) {
              location.href = 'http://cturl.cn/t/kmljc';
              return;
          }
          else if (11 == bizID || 13 == bizID || 1016 == bizID || 1017 == bizID || 15 == bizID || 16 == bizID  || 17 == bizID || 18 == bizID || 19 == bizID || 1018 == bizID || 1020 == bizID  || 1021 == bizID) {
              alert('è¯·å…ˆå®‰è£…è…¾è®¯QQï¼?0ç§’åé¡µé¢è·³è½¬åˆ°è…¾è®¯QQä¸‹è½½é¡µé¢ã€‚\nè‹¥æ‚¨å·²ç»å®‰è£…äº†è…¾è®¯QQï¼Œè¯·åœ¨æµè§ˆå™¨ä¸­å…è®¸è…¾è®¯QQç»„ä»¶çš„è¿è¡Œã€?);
              setTimeout('location.href = "http://im.qq.com/";', 10000);
              return;
          }
          else if (12 == bizID || 1011 == bizID || 1012 == bizID || 1013 == bizID || 1014 == bizID || 1015 == bizID || 1019 == bizID) {
              location.href = 'http://183.62.138.121:18080/qq/proxy.htm';
              return;
          }

          closeWindow();
          return;
      }
      else if (800013811 == g_kfuin)    //å°ç¦åŒ¿åèŠå¤©ä¸šåŠ¡é€»è¾‘
      {
          alert('è¯·å…ˆå®‰è£…QQèŠå¤©è½¯ä»¶');

          maxWindow();

          location.href = 'http://im.qq.com/';

          return;
      }

      anonymous();
    }

    function anonymous(){
      //Anonymous WPA
      var bFromAnonymous = wpaType == 2;
      loadAnonymousWPA(bFromAnonymous);
    }
  });
}

function getSigtSigu(kfuin, param, size) {
    //envé?ï¼Œä¸è¿”å›xmlæ ¼å¼ï¼Œè¿”å›jså›è°ƒ
    if(wpaFrom === '5' || wpaFrom === '7'){
        if(wpaFrom === '5'){
            var fflg = 4;
        }else{
            var fflg = 5;
        }
        var req_data = 'kfguin=' + kfuin + '&p= ' + param + '&s=' + size + '&env=1&v=' + version
                + '&a=' + appointed + '&aty=' + appointedType + '&sv=5&sp=' + sessionParam
                + '&clickid=' + clickId + '&fflg=' + fflg;
    }
    else if(wpaFrom === '3'){
        var req_data = 'kfguin=' + kfuin + '&p=' + param + '&s=' + size + '&env=1&v=' + version
                + '&a=' + appointed + '&aty=' + appointedType + '&sv=' + sessionVersion + '&sp='
                + sessionParam + '&fflg=3';
    }
    else{
        var req_data = 'kfguin=' + kfuin + '&p=' + param + '&s=' + size + '&env=1&v=' + version
                + '&a=' + appointed + '&aty=' + appointedType + '&sv=' + sessionVersion + '&sp='
                + sessionParam + '&fflg=2';
    }

    var myDate = new Date();
    var oScript = document.createElement('script');
    oScript.src = "http://b./" + domain + "/cgi/wpags?" + req_data + "&t=" + myDate.getTime();
    document.getElementsByTagName("head")[0].appendChild(oScript);
}

function onGetSigtSigu(sigUrl) {
    if (null == sigUrl || '' == sigUrl) {
        alert("æ‚¨è¾“å…¥çš„å‚æ•°æœ‰è¯¯ï¼?);

        closeWindow();

        return;
    }

    location.href = sigUrl;

    setTimeout(closeWindow, 1000);
}

function loadAnonymousWPA(bFromAnonymous) {
    var anonymousUrl = "http://webchat.b.qq.com/webchat.htm?sid=" + WPA.encrypt(g_kfuin.toString());

    if (bFromAnonymous) {
        anonymousUrl += "&q=1";
    }

    window.location.replace(anonymousUrl);
}

function IsInstallQQ() {
    try {
        var version = 0;
        if(1 == browserType){
            var xmlhttp = new ActiveXObject("TimwpDll.TimwpCheck");
            version = xmlhttp.GetHummerQQVersion();
        }
        else if(2 == browserType || 3 == browserType){
            var embed = document.getElementById("embed");
            embed.InitActiveX("TimwpDll.TimwpCheck");
            version = embed.GetHummerQQVersion();
        }

        return version;
    }
    catch (e) {
        return -1;
    }
    return -1;
}

function getDomain(referrerUrl) {
    var index = referrerUrl.indexOf('/', 7);
    var domain = referrerUrl.substring(7, index);

    index = domain.lastIndexOf('.');
    var tmp = domain.substr(0, index);
    index = tmp.lastIndexOf('.');

    domain = domain.substr(index + 1);

    return domain;
}

function closeWindow() {
    if ('' != customizeUrl) {
        setTimeout('location.href = customizeUrl;', 1);
        return;
    }

    if (2 != browserType && 3 != browserType) {
        window.opener = null;
        setTimeout('window.open("", "_self"); window.close();', 1);
    }
}

function maxWindow() {
    window.moveTo(0, 0);
    window.resizeTo(screen.availWidth, screen.availHeight);
    window.outerWidth = screen.availWidth;
    window.outerHeight = screen.availHeight;
}

var WPA = {};
WPA.ts = "8ABC7DLO5MN6Z9EFGdeJfghijkHIVrstuvwWSTUXYabclmnopqKPQRxyz01234";
WPA.encrypt = function (n) {
    var nl = n.length;
    var t = [];
    var a, b, c, x;
    var m = function (y) {
        t[t.length] = WPA.ts.charAt(y)
    }
    var N = WPA.ts.length;
    var N2 = N * N;
    var N5 = N * 5;

    for (x = 0; x < nl; x++) {
        a = n.charCodeAt(x);
        if (a < N5) {
            m(Math.floor(a / N));
            m(a % N);
        }
        else {
            m(Math.floor(a / N2) + 5);
            m(Math.floor(a / N) % N);
            m(a % N);
        }
    }
    var s = t.join("");

    return String(s.length).length + String(s.length) + s;
}
</script>
</head>
<body onload="win_onload();">
<embed id="embed" name="embed" type="application/qscall-plugin" width=0 height=0 hidden="true">
</body>
</html>
